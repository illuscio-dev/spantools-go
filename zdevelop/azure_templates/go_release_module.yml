steps:

- script: |
    git checkout -b tempBuildBranch
    git add zdocs/source/_static
    git commit -am "added release version"
  displayName: 'commit changes to temp branch'
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/dev'))

- script: |
    git merge -s ours origin/master
  displayName: 'force merge ours'
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/dev'))

- script: |
    git checkout master
    git pull
    git merge tempBuildBranch
  displayName: 'merge into master'
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/dev'))

- script: |
    git push
  displayName: 'push master'
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/dev'))

- script: |
    git tag -a v$(RELEASE_VERSION) -m "azure pipelines build $(Build.BuildNumber)"
    git push --tags
  displayName: 'publish tagged version'
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/dev'))