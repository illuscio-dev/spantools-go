steps:

- script: python3 zdevelop/azure_scripts/get_release_version.py
  displayName: 'get release version'
  condition: eq(variables['Build.SourceBranch'], 'refs/heads/dev')

- script: echo $(RELEASE_VERSION)
  displayName: 'debug release version'
  condition: eq(variables['Build.SourceBranch'], 'refs/heads/dev')

- script: |
    git checkout -b tempBuildBranch
    git commit -am "added release version"
    git pull origin master
    git merge -s ours origin/master
    git checkout origin/master
    git merge tempBuildBranch
    git push
  displayName: 'merge into master'
  condition: eq(variables['Build.SourceBranch'], 'refs/heads/dev')

- script: |
    git tag -a v$(RELEASE_VERSION) -m "azure pipelines build $(Build.BuildNumber)"
    git push --tags
  displayName: 'publish tagged version'
  condition: eq(variables['Build.SourceBranch'], 'refs/heads/dev')